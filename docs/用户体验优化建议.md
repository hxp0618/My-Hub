# My Hub ç”¨æˆ·ä½“éªŒä¼˜åŒ–å»ºè®®

> æœ¬æ–‡æ¡£åŸºäºä»£ç åº“æ·±åº¦åˆ†æï¼Œæä¾›è¯¦ç»†çš„ UX æ”¹è¿›å»ºè®®ï¼ŒåŒ…å«å…·ä½“å®ç°æ–¹æ¡ˆå’Œä»£ç ç¤ºä¾‹ã€‚

---

## ç›®å½•

1. [åŠ è½½çŠ¶æ€ä¼˜åŒ–](#1-åŠ è½½çŠ¶æ€ä¼˜åŒ–)
2. [é”™è¯¯æç¤ºæ”¹è¿›](#2-é”™è¯¯æç¤ºæ”¹è¿›)
3. [å›½é™…åŒ–ï¼ˆi18nï¼‰æ–¹æ¡ˆ](#3-å›½é™…åŒ–i18næ–¹æ¡ˆ)
4. [æ— éšœç¢è®¿é—®ï¼ˆA11yï¼‰æ”¹è¿›](#4-æ— éšœç¢è®¿é—®a11yæ”¹è¿›)
5. [åŠŸèƒ½å¢å¼ºå»ºè®®](#5-åŠŸèƒ½å¢å¼ºå»ºè®®)
6. [äº¤äº’ä½“éªŒä¼˜åŒ–](#6-äº¤äº’ä½“éªŒä¼˜åŒ–)
7. [æ€§èƒ½æ„ŸçŸ¥ä¼˜åŒ–](#7-æ€§èƒ½æ„ŸçŸ¥ä¼˜åŒ–)

---

## 1. åŠ è½½çŠ¶æ€ä¼˜åŒ–

### 1.1 å½“å‰é—®é¢˜

#### é—®é¢˜ Aï¼šå†å²é¡µé¢åŠ è½½çŠ¶æ€è¿‡äºç®€å•
**æ–‡ä»¶**: `src/pages/newtab/components/HistoryPage.tsx:185-186`

```typescript
if (loading && items.length === 0) {
  return <div className="...">Loading history...</div>;
}
```

**é—®é¢˜**ï¼š
- ä»…æ˜¾ç¤ºçº¯æ–‡æœ¬ï¼Œæ²¡æœ‰è§†è§‰åé¦ˆ
- ç”¨æˆ·ä¸çŸ¥é“åŠ è½½è¿›åº¦
- åŠ è½½å¤§é‡æ•°æ®æ—¶ï¼ˆ10000+ æ¡ï¼‰æ— è¿›åº¦æç¤º

#### é—®é¢˜ Bï¼šä¹¦ç­¾é¡µé¢åŠ è½½çŠ¶æ€å•è°ƒ
**æ–‡ä»¶**: `src/pages/newtab/components/BookmarkPage.tsx:595`

```typescript
if (loading) {
  return <div className="...">Loading bookmarks...</div>;
}
```

#### é—®é¢˜ Cï¼šä¸»é¡µå‰ªè´´æ¿æ£€æµ‹æ— åé¦ˆ
**æ–‡ä»¶**: `src/pages/newtab/components/HomePage.tsx:61-97`

å‰ªè´´æ¿è¯»å–å’Œ URL æ£€æµ‹æ²¡æœ‰åŠ è½½æŒ‡ç¤ºå™¨ï¼Œç”¨æˆ·ä¸çŸ¥é“æ­£åœ¨å¤„ç†ã€‚

---

### 1.2 ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šéª¨æ¶å±ï¼ˆSkeleton Screenï¼‰

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
**éš¾åº¦**: â­â­ ä¸­ç­‰

**åˆ›å»ºéª¨æ¶å±ç»„ä»¶**ï¼š

```typescript
// src/components/SkeletonLoader.tsx
import React from 'react';

export const HistoryItemSkeleton: React.FC = () => (
  <div className="animate-pulse p-4 border-b">
    <div className="flex items-center gap-3">
      <div className="w-4 h-4 bg-gray-300 rounded"></div>
      <div className="w-4 h-4 bg-gray-300 rounded"></div>
      <div className="flex-1">
        <div className="h-4 bg-gray-300 rounded w-3/4 mb-2"></div>
        <div className="h-3 bg-gray-200 rounded w-1/2"></div>
      </div>
    </div>
  </div>
);

export const BookmarkTreeSkeleton: React.FC = () => (
  <div className="animate-pulse space-y-2">
    {[...Array(5)].map((_, i) => (
      <div key={i} className="flex items-center gap-2 p-2">
        <div className="w-4 h-4 bg-gray-300 rounded"></div>
        <div className="h-4 bg-gray-300 rounded flex-1"></div>
      </div>
    ))}
  </div>
);

export const SearchResultSkeleton: React.FC = () => (
  <div className="space-y-3">
    {[...Array(3)].map((_, i) => (
      <div key={i} className="animate-pulse p-3 border rounded">
        <div className="flex items-center gap-3">
          <div className="w-8 h-8 bg-gray-300 rounded"></div>
          <div className="flex-1">
            <div className="h-4 bg-gray-300 rounded w-2/3 mb-2"></div>
            <div className="h-3 bg-gray-200 rounded w-1/2"></div>
          </div>
        </div>
      </div>
    ))}
  </div>
);
```

**åº”ç”¨åˆ°å†å²é¡µé¢**ï¼š

```typescript
// src/pages/newtab/components/HistoryPage.tsx
import { HistoryItemSkeleton } from '@src/components/SkeletonLoader';

// æ›¿æ¢ç¬¬ 185-186 è¡Œ
if (loading && items.length === 0) {
  return (
    <div className="flex-1 overflow-y-auto">
      {[...Array(10)].map((_, i) => (
        <HistoryItemSkeleton key={i} />
      ))}
    </div>
  );
}
```

**åº”ç”¨åˆ°ä¹¦ç­¾é¡µé¢**ï¼š

```typescript
// src/pages/newtab/components/BookmarkPage.tsx
import { BookmarkTreeSkeleton } from '@src/components/SkeletonLoader';

// æ›¿æ¢ç¬¬ 595 è¡Œ
if (loading) {
  return (
    <div className="flex-1 p-4">
      <BookmarkTreeSkeleton />
    </div>
  );
}
```

---

#### æ–¹æ¡ˆ Bï¼šè¿›åº¦æŒ‡ç¤ºå™¨ï¼ˆProgress Indicatorï¼‰

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜ï¼ˆç‰¹åˆ«æ˜¯ AI æ•´ç†åŠŸèƒ½ï¼‰
**éš¾åº¦**: â­ ç®€å•

**åˆ›å»ºè¿›åº¦æ¡ç»„ä»¶**ï¼š

```typescript
// src/components/ProgressBar.tsx
interface ProgressBarProps {
  progress: number; // 0-100
  message?: string;
  showPercentage?: boolean;
}

export const ProgressBar: React.FC<ProgressBarProps> = ({
  progress,
  message,
  showPercentage = true
}) => (
  <div className="w-full">
    {message && (
      <div className="text-sm text-gray-600 mb-2">{message}</div>
    )}
    <div className="w-full bg-gray-200 rounded-full h-2">
      <div
        className="bg-blue-500 h-2 rounded-full transition-all duration-300"
        style={{ width: `${progress}%` }}
      />
    </div>
    {showPercentage && (
      <div className="text-xs text-gray-500 mt-1 text-right">
        {progress}%
      </div>
    )}
  </div>
);
```

**åº”ç”¨åˆ° AI æ•´ç†åŠŸèƒ½**ï¼š

```typescript
// src/pages/newtab/components/BookmarkPage.tsx
// åœ¨ AI æ•´ç†è¿‡ç¨‹ä¸­æ˜¾ç¤ºè¿›åº¦

const [organizingProgress, setOrganizingProgress] = useState(0);

const handleAIOrganize = async () => {
  setOrganizingProgress(0);
  setIsOrganizing(true);

  // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
  const progressInterval = setInterval(() => {
    setOrganizingProgress(prev => Math.min(prev + 10, 90));
  }, 500);

  try {
    const result = await organizeBookmarksWithAI();
    setOrganizingProgress(100);
    // ... å¤„ç†ç»“æœ
  } finally {
    clearInterval(progressInterval);
    setIsOrganizing(false);
  }
};

// æ¸²æŸ“
{isOrganizing && (
  <ProgressBar
    progress={organizingProgress}
    message="AI æ­£åœ¨åˆ†ææ‚¨çš„ä¹¦ç­¾..."
  />
)}
```

---

#### æ–¹æ¡ˆ Cï¼šSpinner ä¸åŠ è½½æç¤ºä¼˜åŒ–

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**éš¾åº¦**: â­ ç®€å•

**åˆ›å»ºç»Ÿä¸€çš„ Spinner ç»„ä»¶**ï¼š

```typescript
// src/components/Spinner.tsx
interface SpinnerProps {
  size?: 'sm' | 'md' | 'lg';
  message?: string;
}

export const Spinner: React.FC<SpinnerProps> = ({
  size = 'md',
  message
}) => {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-8 h-8',
    lg: 'w-12 h-12'
  };

  return (
    <div className="flex flex-col items-center justify-center gap-3">
      <div className={`${sizeClasses[size]} border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin`} />
      {message && (
        <div className="text-sm text-gray-600">{message}</div>
      )}
    </div>
  );
};
```

**åº”ç”¨åˆ°ä¸»é¡µå‰ªè´´æ¿æ£€æµ‹**ï¼š

```typescript
// src/pages/newtab/components/HomePage.tsx
const [clipboardLoading, setClipboardLoading] = useState(false);

useEffect(() => {
  const checkClipboard = async () => {
    setClipboardLoading(true);
    try {
      const text = await navigator.clipboard.readText();
      // ... å¤„ç†é€»è¾‘
    } finally {
      setClipboardLoading(false);
    }
  };
  checkClipboard();
}, []);

// æ¸²æŸ“
{clipboardLoading && (
  <div className="mb-4">
    <Spinner size="sm" message="æ­£åœ¨æ£€æµ‹å‰ªè´´æ¿..." />
  </div>
)}
```

---

### 1.3 åŠ è½½çŠ¶æ€æœ€ä½³å®è·µ

**é€šç”¨è§„åˆ™**ï¼š
1. **0-100ms**: ä¸æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼ˆå³æ—¶å“åº”ï¼‰
2. **100-1000ms**: æ˜¾ç¤º Spinner
3. **1000ms+**: æ˜¾ç¤ºéª¨æ¶å±æˆ–è¿›åº¦æ¡
4. **é•¿æ—¶é—´æ“ä½œï¼ˆ>5sï¼‰**: å¿…é¡»æ˜¾ç¤ºè¿›åº¦ç™¾åˆ†æ¯”

**å®ç°ä¼˜å…ˆçº§**ï¼š
1. ğŸ”¥ **é«˜ä¼˜å…ˆçº§**ï¼šå†å²é¡µé¢éª¨æ¶å±ã€ä¹¦ç­¾é¡µé¢éª¨æ¶å±ã€AI æ•´ç†è¿›åº¦æ¡
2. ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**ï¼šæœç´¢åŠ è½½çŠ¶æ€ã€å‰ªè´´æ¿æ£€æµ‹åŠ è½½
3. ğŸŸ¢ **ä½ä¼˜å…ˆçº§**ï¼šå›¾æ ‡åŠ è½½å ä½ç¬¦

---

## 2. é”™è¯¯æç¤ºæ”¹è¿›

### 2.1 å½“å‰é—®é¢˜

#### é—®é¢˜ Aï¼šLLM æœåŠ¡é”™è¯¯ä¿¡æ¯ä¸å‹å¥½
**æ–‡ä»¶**: `src/services/llmService.ts:84`

```typescript
const error = new Error('æœªé…ç½®æœåŠ¡å•†æˆ– API Key');
```

**é—®é¢˜**ï¼š
- æ²¡æœ‰å‘Šè¯‰ç”¨æˆ·å¦‚ä½•è§£å†³
- ä¸­è‹±æ–‡æ··æ‚
- ä¸åŒºåˆ†ç½‘ç»œé”™è¯¯å’Œé…ç½®é”™è¯¯

#### é—®é¢˜ Bï¼šç½‘ç»œé”™è¯¯æ²¡æœ‰åŒºåˆ†
**æ–‡ä»¶**: `src/services/llmService.ts:135-138`

```typescript
if (!response.ok) {
  const errorBody = await response.text();
  throw new Error(`HTTP error ${response.status}: ${errorBody}`);
}
```

**é—®é¢˜**ï¼š
- ç”¨æˆ·çœ‹åˆ°çš„æ˜¯ HTTP çŠ¶æ€ç ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ„æ€
- æ²¡æœ‰åŒºåˆ† 401ï¼ˆè®¤è¯å¤±è´¥ï¼‰ã€429ï¼ˆé™æµï¼‰ã€500ï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰ç­‰

#### é—®é¢˜ Cï¼šä¹¦ç­¾æ“ä½œå¤±è´¥æ— æç¤º
**æ–‡ä»¶**: `src/pages/newtab/hooks/useBookmarks.ts:282-290`

æ‰¹é‡æ“ä½œå¤±è´¥æ—¶æ²¡æœ‰æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å“ªäº›æ“ä½œæˆåŠŸã€å“ªäº›å¤±è´¥ã€‚

---

### 2.2 ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šåˆ›å»ºé”™è¯¯æç¤ºç³»ç»Ÿ

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
**éš¾åº¦**: â­â­ ä¸­ç­‰

**åˆ›å»º Toast é€šçŸ¥ç»„ä»¶**ï¼š

```typescript
// src/components/Toast.tsx
import { useState, useEffect } from 'react';

type ToastType = 'success' | 'error' | 'warning' | 'info';

interface ToastProps {
  message: string;
  type: ToastType;
  duration?: number;
  onClose: () => void;
  actionText?: string;
  onAction?: () => void;
}

export const Toast: React.FC<ToastProps> = ({
  message,
  type,
  duration = 5000,
  onClose,
  actionText,
  onAction
}) => {
  const [isVisible, setIsVisible] = useState(true);

  useEffect(() => {
    const timer = setTimeout(() => {
      setIsVisible(false);
      setTimeout(onClose, 300);
    }, duration);

    return () => clearTimeout(timer);
  }, [duration, onClose]);

  const bgColors = {
    success: 'bg-green-500',
    error: 'bg-red-500',
    warning: 'bg-yellow-500',
    info: 'bg-blue-500'
  };

  const icons = {
    success: 'âœ“',
    error: 'âœ•',
    warning: 'âš ',
    info: 'â„¹'
  };

  return (
    <div
      className={`
        fixed bottom-4 right-4 ${bgColors[type]} text-white px-4 py-3 rounded-lg shadow-lg
        transition-all duration-300 flex items-center gap-3 max-w-md
        ${isVisible ? 'translate-y-0 opacity-100' : 'translate-y-2 opacity-0'}
      `}
    >
      <span className="text-xl">{icons[type]}</span>
      <span className="flex-1">{message}</span>
      {actionText && onAction && (
        <button
          onClick={onAction}
          className="underline font-semibold"
        >
          {actionText}
        </button>
      )}
      <button onClick={() => setIsVisible(false)} className="text-xl">
        Ã—
      </button>
    </div>
  );
};
```

**åˆ›å»º Toast Hook**ï¼š

```typescript
// src/hooks/useToast.ts
import { useState } from 'react';

interface ToastMessage {
  id: string;
  message: string;
  type: 'success' | 'error' | 'warning' | 'info';
  actionText?: string;
  onAction?: () => void;
}

export const useToast = () => {
  const [toasts, setToasts] = useState<ToastMessage[]>([]);

  const showToast = (
    message: string,
    type: ToastMessage['type'] = 'info',
    actionText?: string,
    onAction?: () => void
  ) => {
    const id = Date.now().toString();
    setToasts(prev => [...prev, { id, message, type, actionText, onAction }]);
  };

  const removeToast = (id: string) => {
    setToasts(prev => prev.filter(t => t.id !== id));
  };

  return {
    toasts,
    showToast,
    removeToast,
    success: (msg: string) => showToast(msg, 'success'),
    error: (msg: string, actionText?: string, onAction?: () => void) =>
      showToast(msg, 'error', actionText, onAction),
    warning: (msg: string) => showToast(msg, 'warning'),
    info: (msg: string) => showToast(msg, 'info')
  };
};
```

---

#### æ–¹æ¡ˆ Bï¼šæ”¹è¿› LLM é”™è¯¯æç¤º

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
**éš¾åº¦**: â­â­ ä¸­ç­‰

**åˆ›å»ºé”™è¯¯æ˜ å°„å·¥å…·**ï¼š

```typescript
// src/utils/errorMessages.ts
export const getErrorMessage = (error: Error): {
  title: string;
  message: string;
  action?: string;
  actionLink?: string;
} => {
  const errorMsg = error.message.toLowerCase();

  // API Key é”™è¯¯
  if (errorMsg.includes('api key') || errorMsg.includes('æœªé…ç½®')) {
    return {
      title: 'æœªé…ç½® API Key',
      message: 'è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½®æ‚¨çš„ LLM æœåŠ¡å•†å’Œ API Keyã€‚',
      action: 'å‰å¾€è®¾ç½®',
      actionLink: '/settings'
    };
  }

  // ç½‘ç»œé”™è¯¯
  if (errorMsg.includes('network') || errorMsg.includes('fetch failed')) {
    return {
      title: 'ç½‘ç»œè¿æ¥å¤±è´¥',
      message: 'è¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œç„¶åé‡è¯•ã€‚',
      action: 'é‡è¯•'
    };
  }

  // 401 è®¤è¯å¤±è´¥
  if (errorMsg.includes('401') || errorMsg.includes('unauthorized')) {
    return {
      title: 'API Key æ— æ•ˆ',
      message: 'æ‚¨çš„ API Key å¯èƒ½å·²è¿‡æœŸæˆ–ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°é…ç½®ã€‚',
      action: 'å‰å¾€è®¾ç½®',
      actionLink: '/settings'
    };
  }

  // 429 é™æµ
  if (errorMsg.includes('429') || errorMsg.includes('rate limit')) {
    return {
      title: 'è¯·æ±‚è¿‡äºé¢‘ç¹',
      message: 'æ‚¨å·²è¾¾åˆ° API è°ƒç”¨é™åˆ¶ï¼Œè¯·ç¨åå†è¯•ã€‚',
      action: 'äº†è§£æ›´å¤š'
    };
  }

  // 500 æœåŠ¡å™¨é”™è¯¯
  if (errorMsg.includes('500') || errorMsg.includes('internal server')) {
    return {
      title: 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨',
      message: 'LLM æœåŠ¡æä¾›å•†å‡ºç°é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•ã€‚',
      action: 'é‡è¯•'
    };
  }

  // Gemini Nano ä¸å¯ç”¨
  if (errorMsg.includes('gemini nano') || errorMsg.includes('prompt api')) {
    return {
      title: 'æœ¬åœ° AI ä¸å¯ç”¨',
      message: 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ° AIï¼Œå·²è‡ªåŠ¨åˆ‡æ¢åˆ°äº‘ç«¯æœåŠ¡ã€‚',
      action: null
    };
  }

  // é€šç”¨é”™è¯¯
  return {
    title: 'æ“ä½œå¤±è´¥',
    message: error.message || 'å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚',
    action: 'é‡è¯•'
  };
};
```

**åº”ç”¨åˆ° LLM æœåŠ¡**ï¼š

```typescript
// src/services/llmService.ts
import { getErrorMessage } from '@src/utils/errorMessages';

// åœ¨è°ƒç”¨å¤„æ•è·é”™è¯¯å¹¶æ˜¾ç¤ºå‹å¥½æç¤º
try {
  await sendMessage(messages, callbacks);
} catch (error) {
  const errorInfo = getErrorMessage(error as Error);
  toast.error(errorInfo.message, errorInfo.action, () => {
    if (errorInfo.actionLink === '/settings') {
      navigateToSettings();
    } else {
      retryOperation();
    }
  });
}
```

---

#### æ–¹æ¡ˆ Cï¼šæ‰¹é‡æ“ä½œç»“æœåé¦ˆ

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**éš¾åº¦**: â­â­ ä¸­ç­‰

**æ”¹è¿›æ‰¹é‡åˆ é™¤åé¦ˆ**ï¼š

```typescript
// src/pages/newtab/components/BookmarkPage.tsx

const handleBatchDelete = async (selectedIds: string[]) => {
  const results = {
    success: 0,
    failed: 0,
    errors: [] as string[]
  };

  for (const id of selectedIds) {
    try {
      await chrome.bookmarks.remove(id);
      results.success++;
    } catch (error) {
      results.failed++;
      results.errors.push(`åˆ é™¤ä¹¦ç­¾å¤±è´¥: ${error.message}`);
    }
  }

  // æ˜¾ç¤ºç»“æœ
  if (results.failed === 0) {
    toast.success(`æˆåŠŸåˆ é™¤ ${results.success} ä¸ªä¹¦ç­¾`);
  } else {
    toast.warning(
      `åˆ é™¤å®Œæˆï¼š${results.success} ä¸ªæˆåŠŸï¼Œ${results.failed} ä¸ªå¤±è´¥`,
      'æŸ¥çœ‹è¯¦æƒ…',
      () => showErrorDetails(results.errors)
    );
  }
};
```

---

### 2.3 é”™è¯¯æç¤ºæœ€ä½³å®è·µ

**é”™è¯¯æ¶ˆæ¯åº”åŒ…å«**ï¼š
1. âœ… **å‘ç”Ÿäº†ä»€ä¹ˆ**ï¼šç®€çŸ­çš„é”™è¯¯æ ‡é¢˜
2. âœ… **ä¸ºä»€ä¹ˆå‘ç”Ÿ**ï¼šåŸå› è¯´æ˜
3. âœ… **å¦‚ä½•è§£å†³**ï¼šæ˜ç¡®çš„æ“ä½œå»ºè®®
4. âœ… **æ“ä½œæŒ‰é’®**ï¼šä¸€é”®è·³è½¬åˆ°è§£å†³æ–¹æ¡ˆ

**ç¤ºä¾‹å¯¹æ¯”**ï¼š

âŒ **ä¸å¥½çš„é”™è¯¯æç¤º**ï¼š
```
Error: API key not configured
```

âœ… **å¥½çš„é”™è¯¯æç¤º**ï¼š
```
æ ‡é¢˜ï¼šæœªé…ç½® API Key
å†…å®¹ï¼šè¦ä½¿ç”¨ AI åŠŸèƒ½ï¼Œæ‚¨éœ€è¦å…ˆé…ç½® LLM æœåŠ¡å•†å’Œ API Keyã€‚
æŒ‰é’®ï¼š[å‰å¾€è®¾ç½®]
```

---

## 3. å›½é™…åŒ–ï¼ˆi18nï¼‰æ–¹æ¡ˆ

### 3.1 å½“å‰é—®é¢˜

**æ–‡ä»¶**: å¤šå¤„ä»£ç æ··æ‚ä¸­è‹±æ–‡

ç¤ºä¾‹ï¼š
- `llmService.ts:84`: "æœªé…ç½®æœåŠ¡å•†æˆ– API Key"
- `HistoryPage.tsx:185`: "Loading history..."
- `BookmarkPage.tsx:595`: "Loading bookmarks..."

**é—®é¢˜**ï¼š
- ä¸åŒæ–‡ä»¶ä½¿ç”¨ä¸åŒè¯­è¨€
- æ— æ³•åˆ‡æ¢è¯­è¨€
- ç»´æŠ¤å›°éš¾

---

### 3.2 ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šé›†æˆ react-i18next

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**éš¾åº¦**: â­â­â­ è¾ƒé«˜

**1. å®‰è£…ä¾èµ–**ï¼š

```bash
npm install i18next react-i18next i18next-browser-languagedetector
```

**2. åˆ›å»ºè¯­è¨€æ–‡ä»¶**ï¼š

```json
// src/locales/zh-CN.json
{
  "common": {
    "loading": "åŠ è½½ä¸­...",
    "save": "ä¿å­˜",
    "cancel": "å–æ¶ˆ",
    "delete": "åˆ é™¤",
    "confirm": "ç¡®è®¤"
  },
  "history": {
    "loading": "æ­£åœ¨åŠ è½½å†å²è®°å½•...",
    "empty": "æš‚æ— å†å²è®°å½•",
    "deleteConfirm": "ç¡®å®šè¦åˆ é™¤è¿™ {{count}} æ¡å†å²è®°å½•å—ï¼Ÿ"
  },
  "bookmarks": {
    "loading": "æ­£åœ¨åŠ è½½ä¹¦ç­¾...",
    "empty": "æš‚æ— ä¹¦ç­¾",
    "addFolder": "æ–°å»ºæ–‡ä»¶å¤¹",
    "organize": "AI æ•´ç†"
  },
  "llm": {
    "errors": {
      "noApiKey": "è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½®æ‚¨çš„ LLM æœåŠ¡å•†å’Œ API Key",
      "networkError": "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥",
      "unauthorized": "API Key æ— æ•ˆï¼Œè¯·é‡æ–°é…ç½®",
      "rateLimit": "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"
    }
  }
}
```

```json
// src/locales/en-US.json
{
  "common": {
    "loading": "Loading...",
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "confirm": "Confirm"
  },
  "history": {
    "loading": "Loading history...",
    "empty": "No history found",
    "deleteConfirm": "Are you sure you want to delete {{count}} history items?"
  },
  "bookmarks": {
    "loading": "Loading bookmarks...",
    "empty": "No bookmarks found",
    "addFolder": "New Folder",
    "organize": "AI Organize"
  },
  "llm": {
    "errors": {
      "noApiKey": "Please configure your LLM provider and API Key in settings",
      "networkError": "Network connection failed, please check your internet",
      "unauthorized": "Invalid API Key, please reconfigure",
      "rateLimit": "Too many requests, please try again later"
    }
  }
}
```

**3. åˆå§‹åŒ– i18next**ï¼š

```typescript
// src/i18n/index.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

import zhCN from '@locales/zh-CN.json';
import enUS from '@locales/en-US.json';

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources: {
      'zh-CN': { translation: zhCN },
      'en-US': { translation: enUS }
    },
    fallbackLng: 'en-US',
    interpolation: {
      escapeValue: false
    }
  });

export default i18n;
```

**4. åº”ç”¨åˆ°ç»„ä»¶**ï¼š

```typescript
// src/pages/newtab/components/HistoryPage.tsx
import { useTranslation } from 'react-i18next';

const HistoryPage: React.FC = () => {
  const { t } = useTranslation();

  if (loading && items.length === 0) {
    return (
      <div className="flex-1 flex items-center justify-center">
        <Spinner message={t('history.loading')} />
      </div>
    );
  }

  if (items.length === 0) {
    return (
      <div className="flex-1 flex items-center justify-center text-gray-500">
        {t('history.empty')}
      </div>
    );
  }

  // ...
};
```

**5. åˆ›å»ºè¯­è¨€åˆ‡æ¢å™¨**ï¼š

```typescript
// src/components/LanguageSwitcher.tsx
import { useTranslation } from 'react-i18next';

export const LanguageSwitcher: React.FC = () => {
  const { i18n } = useTranslation();

  const languages = [
    { code: 'zh-CN', name: 'ç®€ä½“ä¸­æ–‡' },
    { code: 'en-US', name: 'English' }
  ];

  return (
    <select
      value={i18n.language}
      onChange={(e) => i18n.changeLanguage(e.target.value)}
      className="px-3 py-2 border rounded"
    >
      {languages.map(lang => (
        <option key={lang.code} value={lang.code}>
          {lang.name}
        </option>
      ))}
    </select>
  );
};
```

---

#### æ–¹æ¡ˆ Bï¼šç®€åŒ–ç‰ˆ i18nï¼ˆä¸ä½¿ç”¨åº“ï¼‰

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
**éš¾åº¦**: â­ ç®€å•

å¦‚æœä¸æƒ³å¼•å…¥é¢å¤–ä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„ç¿»è¯‘å‡½æ•°ï¼š

```typescript
// src/utils/i18n.ts
const translations = {
  'zh-CN': {
    'loading': 'åŠ è½½ä¸­...',
    'history.loading': 'æ­£åœ¨åŠ è½½å†å²è®°å½•...',
    // ... æ›´å¤šç¿»è¯‘
  },
  'en-US': {
    'loading': 'Loading...',
    'history.loading': 'Loading history...',
    // ... æ›´å¤šç¿»è¯‘
  }
};

let currentLang = navigator.language || 'en-US';

export const t = (key: string): string => {
  return translations[currentLang]?.[key] || key;
};

export const setLanguage = (lang: string) => {
  currentLang = lang;
  localStorage.setItem('language', lang);
};
```

---

### 3.3 å®ç°ä¼˜å…ˆçº§

1. ğŸ”¥ **ç¬¬ä¸€é˜¶æ®µ**ï¼šç»Ÿä¸€å½“å‰ä»£ç çš„è¯­è¨€ï¼ˆå…¨éƒ¨æ”¹ä¸ºä¸­æ–‡æˆ–è‹±æ–‡ï¼‰
2. ğŸŸ¡ **ç¬¬äºŒé˜¶æ®µ**ï¼šå¼•å…¥ i18nextï¼Œæ”¯æŒä¸­è‹±æ–‡åˆ‡æ¢
3. ğŸŸ¢ **ç¬¬ä¸‰é˜¶æ®µ**ï¼šæ·»åŠ æ›´å¤šè¯­è¨€æ”¯æŒ

---

## 4. æ— éšœç¢è®¿é—®ï¼ˆA11yï¼‰æ”¹è¿›

### 4.1 å½“å‰é—®é¢˜

#### é—®é¢˜ Aï¼šå¤é€‰æ¡†ç¼ºå°‘æ ‡ç­¾
**æ–‡ä»¶**: `src/components/ItemCard.tsx:146-152`

```typescript
<input
  type="checkbox"
  checked={isSelected}
  onChange={handleCheckboxChange}
  className="..."
/>
```

**é—®é¢˜**ï¼šå±å¹•é˜…è¯»å™¨æ— æ³•è¯†åˆ«è¿™æ˜¯ä»€ä¹ˆå¤é€‰æ¡†ã€‚

#### é—®é¢˜ Bï¼šæŒ‰é’®ç¼ºå°‘ ARIA æ ‡ç­¾
**æ–‡ä»¶**: `src/components/ItemCard.tsx:155-161`

```typescript
<button onClick={handleDelete} className="...">
  <svg>...</svg>
</button>
```

**é—®é¢˜**ï¼šå›¾æ ‡æŒ‰é’®æ²¡æœ‰æ–‡æœ¬ï¼Œå±å¹•é˜…è¯»å™¨ä¸çŸ¥é“æŒ‰é’®ç”¨é€”ã€‚

#### é—®é¢˜ Cï¼šæ¨¡æ€æ¡†æ²¡æœ‰ç„¦ç‚¹ç®¡ç†
**æ–‡ä»¶**: `src/components/Modal.tsx`

**é—®é¢˜**ï¼š
- æ‰“å¼€æ¨¡æ€æ¡†æ—¶ç„¦ç‚¹æ²¡æœ‰è‡ªåŠ¨ç§»å…¥
- æ— æ³•ç”¨ Tab é”®åœ¨æ¨¡æ€æ¡†å†…å¾ªç¯
- æŒ‰ Esc é”®æ— æ³•å…³é—­

---

### 4.2 ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šä¸ºäº¤äº’å…ƒç´ æ·»åŠ  ARIA æ ‡ç­¾

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
**éš¾åº¦**: â­ ç®€å•

**æ”¹è¿›å¤é€‰æ¡†**ï¼š

```typescript
// src/components/ItemCard.tsx
<label className="flex items-center gap-2">
  <input
    type="checkbox"
    checked={isSelected}
    onChange={handleCheckboxChange}
    className="..."
    aria-label={`é€‰æ‹©ä¹¦ç­¾: ${title}`}
  />
  <span className="sr-only">é€‰æ‹©æ­¤é¡¹</span>
</label>
```

**æ”¹è¿›å›¾æ ‡æŒ‰é’®**ï¼š

```typescript
// src/components/ItemCard.tsx
<button
  onClick={handleDelete}
  className="..."
  aria-label={`åˆ é™¤ ${title}`}
  title="åˆ é™¤"
>
  <svg aria-hidden="true">...</svg>
</button>

<button
  onClick={handleEdit}
  className="..."
  aria-label={`ç¼–è¾‘ ${title}`}
  title="ç¼–è¾‘"
>
  <svg aria-hidden="true">...</svg>
</button>
```

**æ·»åŠ å±å¹•é˜…è¯»å™¨ä¸“ç”¨æ–‡æœ¬æ ·å¼**ï¼š

```css
/* src/index.css */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}
```

---

#### æ–¹æ¡ˆ Bï¼šæ¨¡æ€æ¡†ç„¦ç‚¹ç®¡ç†

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
**éš¾åº¦**: â­â­ ä¸­ç­‰

**åˆ›å»ºå¯è®¿é—®çš„æ¨¡æ€æ¡†ç»„ä»¶**ï¼š

```typescript
// src/components/AccessibleModal.tsx
import { useEffect, useRef } from 'react';

interface AccessibleModalProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: React.ReactNode;
}

export const AccessibleModal: React.FC<AccessibleModalProps> = ({
  isOpen,
  onClose,
  title,
  children
}) => {
  const modalRef = useRef<HTMLDivElement>(null);
  const previousFocusRef = useRef<HTMLElement | null>(null);

  useEffect(() => {
    if (isOpen) {
      // ä¿å­˜å½“å‰ç„¦ç‚¹å…ƒç´ 
      previousFocusRef.current = document.activeElement as HTMLElement;

      // å°†ç„¦ç‚¹ç§»åˆ°æ¨¡æ€æ¡†
      modalRef.current?.focus();

      // ç›‘å¬ Esc é”®
      const handleEscape = (e: KeyboardEvent) => {
        if (e.key === 'Escape') {
          onClose();
        }
      };
      document.addEventListener('keydown', handleEscape);

      return () => {
        document.removeEventListener('keydown', handleEscape);
        // æ¢å¤ä¹‹å‰çš„ç„¦ç‚¹
        previousFocusRef.current?.focus();
      };
    }
  }, [isOpen, onClose]);

  if (!isOpen) return null;

  return (
    <div
      className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
      onClick={onClose}
      aria-modal="true"
      role="dialog"
      aria-labelledby="modal-title"
    >
      <div
        ref={modalRef}
        className="bg-white rounded-lg p-6 max-w-2xl w-full"
        onClick={(e) => e.stopPropagation()}
        tabIndex={-1}
      >
        <div className="flex justify-between items-center mb-4">
          <h2 id="modal-title" className="text-xl font-bold">
            {title}
          </h2>
          <button
            onClick={onClose}
            aria-label="å…³é—­å¯¹è¯æ¡†"
            className="text-gray-500 hover:text-gray-700"
          >
            âœ•
          </button>
        </div>
        {children}
      </div>
    </div>
  );
};
```

**å®ç°ç„¦ç‚¹é™·é˜±ï¼ˆFocus Trapï¼‰**ï¼š

```typescript
// src/hooks/useFocusTrap.ts
import { useEffect, useRef } from 'react';

export const useFocusTrap = (isActive: boolean) => {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (!isActive) return;

    const container = containerRef.current;
    if (!container) return;

    const focusableElements = container.querySelectorAll(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    );

    const firstElement = focusableElements[0] as HTMLElement;
    const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;

    const handleTab = (e: KeyboardEvent) => {
      if (e.key !== 'Tab') return;

      if (e.shiftKey) {
        // Shift + Tab
        if (document.activeElement === firstElement) {
          lastElement.focus();
          e.preventDefault();
        }
      } else {
        // Tab
        if (document.activeElement === lastElement) {
          firstElement.focus();
          e.preventDefault();
        }
      }
    };

    container.addEventListener('keydown', handleTab);
    firstElement?.focus();

    return () => {
      container.removeEventListener('keydown', handleTab);
    };
  }, [isActive]);

  return containerRef;
};
```

---

#### æ–¹æ¡ˆ Cï¼šé”®ç›˜å¯¼èˆªæ”¯æŒ

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**éš¾åº¦**: â­â­ ä¸­ç­‰

**ä¸ºä¹¦ç­¾æ ‘æ·»åŠ é”®ç›˜å¯¼èˆª**ï¼š

```typescript
// src/components/BookmarkTree.tsx
const handleKeyDown = (e: React.KeyboardEvent, node: BookmarkNode) => {
  switch (e.key) {
    case 'Enter':
    case ' ':
      // é€‰ä¸­/å–æ¶ˆé€‰ä¸­
      handleToggleSelect(node.id);
      e.preventDefault();
      break;
    case 'ArrowRight':
      // å±•å¼€æ–‡ä»¶å¤¹
      if (!node.url && !expandedFolders.has(node.id)) {
        handleToggleExpand(node.id);
      }
      e.preventDefault();
      break;
    case 'ArrowLeft':
      // æ”¶èµ·æ–‡ä»¶å¤¹
      if (!node.url && expandedFolders.has(node.id)) {
        handleToggleExpand(node.id);
      }
      e.preventDefault();
      break;
    case 'Delete':
      // åˆ é™¤
      handleDelete(node.id);
      e.preventDefault();
      break;
  }
};

// åº”ç”¨åˆ°èŠ‚ç‚¹
<div
  role="treeitem"
  tabIndex={0}
  onKeyDown={(e) => handleKeyDown(e, node)}
  aria-expanded={!node.url ? expandedFolders.has(node.id) : undefined}
  aria-selected={selectedItems.has(node.id)}
>
  {/* å†…å®¹ */}
</div>
```

---

#### æ–¹æ¡ˆ Dï¼šæ·»åŠ è·³è¿‡å¯¼èˆªé“¾æ¥

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
**éš¾åº¦**: â­ ç®€å•

```typescript
// src/pages/newtab/Newtab.tsx
<div>
  {/* è·³è¿‡å¯¼èˆªé“¾æ¥ */}
  <a
    href="#main-content"
    className="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-blue-500 text-white px-4 py-2 rounded"
  >
    è·³åˆ°ä¸»è¦å†…å®¹
  </a>

  {/* å¯¼èˆªæ  */}
  <nav>...</nav>

  {/* ä¸»è¦å†…å®¹ */}
  <main id="main-content" tabIndex={-1}>
    {/* é¡µé¢å†…å®¹ */}
  </main>
</div>
```

---

### 4.3 æ— éšœç¢æ£€æŸ¥æ¸…å•

ä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡Œæ£€æŸ¥ï¼š

**è‡ªåŠ¨åŒ–å·¥å…·**ï¼š
- âœ… [axe DevTools](https://chrome.google.com/webstore/detail/axe-devtools-web-accessib/lhdoppojpmngadmnindnejefpokejbdd)
- âœ… [Lighthouse Accessibility](https://developers.google.com/web/tools/lighthouse)
- âœ… [WAVE](https://wave.webaim.org/extension/)

**æ‰‹åŠ¨æµ‹è¯•**ï¼š
- âœ… ä»…ä½¿ç”¨é”®ç›˜æ“ä½œæ‰€æœ‰åŠŸèƒ½
- âœ… ä½¿ç”¨å±å¹•é˜…è¯»å™¨ï¼ˆNVDA/JAWS/VoiceOverï¼‰æµ‹è¯•
- âœ… æ”¾å¤§åˆ° 200% æ£€æŸ¥å¯è¯»æ€§

---

## 5. åŠŸèƒ½å¢å¼ºå»ºè®®

### 5.1 æ’¤é”€/é‡åšåŠŸèƒ½

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
**éš¾åº¦**: â­â­â­ è¾ƒé«˜

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç”¨æˆ·ä¸å°å¿ƒæ‰¹é‡åˆ é™¤ä¹¦ç­¾
- ç”¨æˆ·æƒ³æ’¤é”€ AI æ•´ç†çš„ç»“æœ
- ç”¨æˆ·è¯¯åˆ å†å²è®°å½•

**å®ç°æ–¹æ¡ˆ**ï¼š

```typescript
// src/hooks/useUndoRedo.ts
interface HistoryItem {
  type: 'delete' | 'create' | 'move' | 'update';
  data: any;
  undo: () => Promise<void>;
  redo: () => Promise<void>;
}

export const useUndoRedo = () => {
  const [history, setHistory] = useState<HistoryItem[]>([]);
  const [currentIndex, setCurrentIndex] = useState(-1);

  const canUndo = currentIndex >= 0;
  const canRedo = currentIndex < history.length - 1;

  const addAction = (action: HistoryItem) => {
    // ç§»é™¤å½“å‰ç´¢å¼•ä¹‹åçš„å†å²
    const newHistory = history.slice(0, currentIndex + 1);
    newHistory.push(action);
    setHistory(newHistory);
    setCurrentIndex(newHistory.length - 1);

    // é™åˆ¶å†å²è®°å½•æ•°é‡ï¼ˆæœ€å¤šä¿ç•™ 50 æ¡ï¼‰
    if (newHistory.length > 50) {
      setHistory(newHistory.slice(-50));
      setCurrentIndex(49);
    }
  };

  const undo = async () => {
    if (!canUndo) return;
    await history[currentIndex].undo();
    setCurrentIndex(currentIndex - 1);
  };

  const redo = async () => {
    if (!canRedo) return;
    await history[currentIndex + 1].redo();
    setCurrentIndex(currentIndex + 1);
  };

  return { undo, redo, addAction, canUndo, canRedo };
};
```

**åº”ç”¨åˆ°ä¹¦ç­¾åˆ é™¤**ï¼š

```typescript
// src/pages/newtab/components/BookmarkPage.tsx
const { undo, redo, addAction, canUndo, canRedo } = useUndoRedo();

const handleDeleteBookmark = async (id: string) => {
  // ä¿å­˜å½“å‰çŠ¶æ€
  const bookmark = await chrome.bookmarks.get(id);

  // æ‰§è¡Œåˆ é™¤
  await chrome.bookmarks.remove(id);

  // æ·»åŠ åˆ°æ’¤é”€å†å²
  addAction({
    type: 'delete',
    data: bookmark[0],
    undo: async () => {
      // æ¢å¤ä¹¦ç­¾
      await chrome.bookmarks.create({
        parentId: bookmark[0].parentId,
        title: bookmark[0].title,
        url: bookmark[0].url,
        index: bookmark[0].index
      });
      toast.success('å·²æ’¤é”€åˆ é™¤');
    },
    redo: async () => {
      // é‡æ–°åˆ é™¤
      await chrome.bookmarks.remove(id);
      toast.info('å·²é‡åšåˆ é™¤');
    }
  });

  // æ˜¾ç¤ºæ’¤é”€æç¤º
  toast.success('å·²åˆ é™¤ä¹¦ç­¾', 'æ’¤é”€', () => undo());
};
```

**UI æ§ä»¶**ï¼š

```typescript
// æ·»åŠ æ’¤é”€/é‡åšæŒ‰é’®
<div className="flex gap-2">
  <button
    onClick={undo}
    disabled={!canUndo}
    className={`px-3 py-1 rounded ${canUndo ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-500'}`}
    aria-label="æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ"
  >
    â†¶ æ’¤é”€
  </button>
  <button
    onClick={redo}
    disabled={!canRedo}
    className={`px-3 py-1 rounded ${canRedo ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-500'}`}
    aria-label="é‡åšä¸Šä¸€æ­¥æ“ä½œ"
  >
    â†· é‡åš
  </button>
</div>
```

**é”®ç›˜å¿«æ·é”®**ï¼š

```typescript
// src/hooks/useKeyboardShortcuts.ts
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    // Ctrl+Z / Cmd+Z - æ’¤é”€
    if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
      e.preventDefault();
      undo();
    }
    // Ctrl+Shift+Z / Cmd+Shift+Z - é‡åš
    if ((e.ctrlKey || e.metaKey) && e.key === 'z' && e.shiftKey) {
      e.preventDefault();
      redo();
    }
  };

  document.addEventListener('keydown', handleKeyDown);
  return () => document.removeEventListener('keydown', handleKeyDown);
}, [undo, redo]);
```

---

### 5.2 ä¹¦ç­¾å¯¼å…¥åŠŸèƒ½

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**éš¾åº¦**: â­â­ ä¸­ç­‰

**å½“å‰çŠ¶æ€**ï¼š
- âœ… å·²æœ‰å¯¼å‡ºåŠŸèƒ½ï¼ˆ`src/lib/bookmarkExport.ts`ï¼‰
- âŒ ç¼ºå°‘å¯¼å…¥åŠŸèƒ½

**å®ç°æ–¹æ¡ˆ**ï¼š

```typescript
// src/lib/bookmarkImport.ts
export const importBookmarksFromHTML = async (file: File): Promise<void> => {
  const text = await file.text();
  const parser = new DOMParser();
  const doc = parser.parseFromString(text, 'text/html');

  const parseNode = async (
    element: Element,
    parentId: string
  ): Promise<void> => {
    const links = element.querySelectorAll(':scope > DT > A');
    const folders = element.querySelectorAll(':scope > DT > H3');

    // å¯¼å…¥ä¹¦ç­¾
    for (const link of Array.from(links)) {
      const url = link.getAttribute('href');
      const title = link.textContent || '';
      if (url) {
        await chrome.bookmarks.create({
          parentId,
          title,
          url
        });
      }
    }

    // å¯¼å…¥æ–‡ä»¶å¤¹
    for (const folder of Array.from(folders)) {
      const title = folder.textContent || 'Untitled';
      const newFolder = await chrome.bookmarks.create({
        parentId,
        title
      });

      const dl = folder.nextElementSibling;
      if (dl && dl.tagName === 'DL') {
        await parseNode(dl, newFolder.id);
      }
    }
  };

  const dlElement = doc.querySelector('DL');
  if (dlElement) {
    const bookmarkBar = await chrome.bookmarks.getTree();
    const bookmarkBarId = bookmarkBar[0].children?.[0].id || '1';
    await parseNode(dlElement, bookmarkBarId);
  }
};

export const importBookmarksFromJSON = async (file: File): Promise<void> => {
  const text = await file.text();
  const data = JSON.parse(text);

  // å‡è®¾ JSON æ ¼å¼ä¸º { bookmarks: [...] }
  const importNode = async (node: any, parentId: string): Promise<void> => {
    if (node.url) {
      // ä¹¦ç­¾
      await chrome.bookmarks.create({
        parentId,
        title: node.title,
        url: node.url
      });
    } else {
      // æ–‡ä»¶å¤¹
      const folder = await chrome.bookmarks.create({
        parentId,
        title: node.title
      });

      if (node.children) {
        for (const child of node.children) {
          await importNode(child, folder.id);
        }
      }
    }
  };

  for (const bookmark of data.bookmarks) {
    await importNode(bookmark, '1'); // '1' æ˜¯ä¹¦ç­¾æ  ID
  }
};
```

**UI ç»„ä»¶**ï¼š

```typescript
// src/components/BookmarkImporter.tsx
export const BookmarkImporter: React.FC = () => {
  const [importing, setImporting] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleImport = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    setImporting(true);
    try {
      if (file.name.endsWith('.html')) {
        await importBookmarksFromHTML(file);
      } else if (file.name.endsWith('.json')) {
        await importBookmarksFromJSON(file);
      } else {
        throw new Error('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼');
      }
      toast.success('ä¹¦ç­¾å¯¼å…¥æˆåŠŸï¼');
    } catch (error) {
      toast.error(`å¯¼å…¥å¤±è´¥: ${error.message}`);
    } finally {
      setImporting(false);
    }
  };

  return (
    <div>
      <input
        ref={fileInputRef}
        type="file"
        accept=".html,.json"
        onChange={handleImport}
        className="hidden"
      />
      <button
        onClick={() => fileInputRef.current?.click()}
        disabled={importing}
        className="px-4 py-2 bg-blue-500 text-white rounded"
      >
        {importing ? 'å¯¼å…¥ä¸­...' : 'å¯¼å…¥ä¹¦ç­¾'}
      </button>
    </div>
  );
};
```

---

### 5.3 æœç´¢å†å²è®°å½•

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
**éš¾åº¦**: â­ ç®€å•

**å®ç°æ–¹æ¡ˆ**ï¼š

```typescript
// src/hooks/useSearchHistory.ts
const MAX_HISTORY = 10;

export const useSearchHistory = () => {
  const [history, setHistory] = useState<string[]>(() => {
    const saved = localStorage.getItem('searchHistory');
    return saved ? JSON.parse(saved) : [];
  });

  const addSearch = (query: string) => {
    if (!query.trim()) return;

    const newHistory = [
      query,
      ...history.filter(item => item !== query)
    ].slice(0, MAX_HISTORY);

    setHistory(newHistory);
    localStorage.setItem('searchHistory', JSON.stringify(newHistory));
  };

  const clearHistory = () => {
    setHistory([]);
    localStorage.removeItem('searchHistory');
  };

  return { history, addSearch, clearHistory };
};
```

**UI é›†æˆ**ï¼š

```typescript
// src/components/UnifiedSearchBar.tsx
const { history, addSearch } = useSearchHistory();
const [showHistory, setShowHistory] = useState(false);

// å½“æœç´¢æ¡†è·å¾—ç„¦ç‚¹æ—¶æ˜¾ç¤ºå†å²
<input
  value={searchTerm}
  onChange={(e) => setSearchTerm(e.target.value)}
  onFocus={() => setShowHistory(true)}
  onBlur={() => setTimeout(() => setShowHistory(false), 200)}
  onKeyDown={(e) => {
    if (e.key === 'Enter') {
      addSearch(searchTerm);
    }
  }}
/>

{/* æœç´¢å†å²ä¸‹æ‹‰èœå• */}
{showHistory && history.length > 0 && (
  <div className="absolute top-full left-0 right-0 bg-white border rounded-b shadow-lg">
    {history.map((item, i) => (
      <div
        key={i}
        onClick={() => {
          setSearchTerm(item);
          addSearch(item);
        }}
        className="px-3 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2"
      >
        <span>ğŸ•</span>
        <span>{item}</span>
      </div>
    ))}
  </div>
)}
```

---

### 5.4 ä¹¦ç­¾é¢„è§ˆåŠŸèƒ½

**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½
**éš¾åº¦**: â­â­â­ è¾ƒé«˜

**å®ç°æ–¹æ¡ˆ**ï¼š

```typescript
// src/components/BookmarkPreview.tsx
interface BookmarkPreviewProps {
  url: string;
}

export const BookmarkPreview: React.FC<BookmarkPreviewProps> = ({ url }) => {
  const [metadata, setMetadata] = useState<{
    title?: string;
    description?: string;
    image?: string;
  } | null>(null);

  useEffect(() => {
    // ä» Open Graph å…ƒæ•°æ®æˆ–å…¶ä»–æ¥æºè·å–é¢„è§ˆä¿¡æ¯
    fetchMetadata(url).then(setMetadata);
  }, [url]);

  if (!metadata) return null;

  return (
    <div className="absolute z-10 bg-white border rounded shadow-lg p-4 w-80">
      {metadata.image && (
        <img src={metadata.image} alt="" className="w-full h-40 object-cover rounded mb-2" />
      )}
      <h3 className="font-semibold mb-1">{metadata.title}</h3>
      <p className="text-sm text-gray-600">{metadata.description}</p>
    </div>
  );
};

// ä½¿ç”¨ Popover æ˜¾ç¤º
<Popover>
  <PopoverTrigger>
    <div className="bookmark-item">...</div>
  </PopoverTrigger>
  <PopoverContent>
    <BookmarkPreview url={bookmark.url} />
  </PopoverContent>
</Popover>
```

---

## 6. äº¤äº’ä½“éªŒä¼˜åŒ–

### 6.1 æ‰¹é‡æ“ä½œç¡®è®¤æœºåˆ¶

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
**éš¾åº¦**: â­ ç®€å•

**åˆ›å»ºç¡®è®¤å¯¹è¯æ¡†**ï¼š

```typescript
// src/components/ConfirmDialog.tsx
interface ConfirmDialogProps {
  isOpen: boolean;
  onClose: () => void;
  onConfirm: () => void;
  title: string;
  message: string;
  confirmText?: string;
  cancelText?: string;
  danger?: boolean;
}

export const ConfirmDialog: React.FC<ConfirmDialogProps> = ({
  isOpen,
  onClose,
  onConfirm,
  title,
  message,
  confirmText = 'ç¡®è®¤',
  cancelText = 'å–æ¶ˆ',
  danger = false
}) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg p-6 max-w-md">
        <h3 className="text-lg font-semibold mb-2">{title}</h3>
        <p className="text-gray-600 mb-4">{message}</p>
        <div className="flex justify-end gap-2">
          <button
            onClick={onClose}
            className="px-4 py-2 border rounded hover:bg-gray-100"
          >
            {cancelText}
          </button>
          <button
            onClick={() => {
              onConfirm();
              onClose();
            }}
            className={`px-4 py-2 rounded text-white ${
              danger ? 'bg-red-500 hover:bg-red-600' : 'bg-blue-500 hover:bg-blue-600'
            }`}
          >
            {confirmText}
          </button>
        </div>
      </div>
    </div>
  );
};
```

**åº”ç”¨åˆ°æ‰¹é‡åˆ é™¤**ï¼š

```typescript
const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

const handleBatchDelete = () => {
  if (selectedItems.size === 0) return;
  setShowDeleteConfirm(true);
};

<ConfirmDialog
  isOpen={showDeleteConfirm}
  onClose={() => setShowDeleteConfirm(false)}
  onConfirm={async () => {
    // æ‰§è¡Œåˆ é™¤
    for (const id of selectedItems) {
      await chrome.bookmarks.remove(id);
    }
    toast.success(`å·²åˆ é™¤ ${selectedItems.size} ä¸ªä¹¦ç­¾`);
  }}
  title="ç¡®è®¤åˆ é™¤"
  message={`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedItems.size} ä¸ªä¹¦ç­¾å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`}
  confirmText="åˆ é™¤"
  cancelText="å–æ¶ˆ"
  danger={true}
/>
```

---

### 6.2 æ‹–æ‹½æ’åºæ”¯æŒ

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**éš¾åº¦**: â­â­â­ è¾ƒé«˜

**ä½¿ç”¨ dnd-kit åº“**ï¼š

```bash
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```

**å®ç°æ‹–æ‹½ä¹¦ç­¾**ï¼š

```typescript
// src/components/DraggableBookmarkTree.tsx
import { DndContext, closestCenter, DragEndEvent } from '@dnd-kit/core';
import { SortableContext, useSortable, verticalListSortingStrategy } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';

const SortableBookmarkItem: React.FC<{ bookmark: BookmarkNode }> = ({ bookmark }) => {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition
  } = useSortable({ id: bookmark.id });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition
  };

  return (
    <div ref={setNodeRef} style={style} {...attributes} {...listeners}>
      {/* ä¹¦ç­¾å†…å®¹ */}
    </div>
  );
};

export const DraggableBookmarkTree: React.FC = () => {
  const handleDragEnd = async (event: DragEndEvent) => {
    const { active, over } = event;

    if (over && active.id !== over.id) {
      // æ›´æ–°ä¹¦ç­¾é¡ºåº
      await chrome.bookmarks.move(active.id as string, {
        parentId: over.id as string
      });
    }
  };

  return (
    <DndContext collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
      <SortableContext items={bookmarks} strategy={verticalListSortingStrategy}>
        {bookmarks.map(bookmark => (
          <SortableBookmarkItem key={bookmark.id} bookmark={bookmark} />
        ))}
      </SortableContext>
    </DndContext>
  );
};
```

---

### 6.3 é”®ç›˜å¿«æ·é”®æ”¯æŒ

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**éš¾åº¦**: â­â­ ä¸­ç­‰

**åˆ›å»ºå¿«æ·é”®ç®¡ç†å™¨**ï¼š

```typescript
// src/hooks/useKeyboardShortcuts.ts
interface ShortcutConfig {
  key: string;
  ctrl?: boolean;
  shift?: boolean;
  alt?: boolean;
  meta?: boolean;
  action: () => void;
  description: string;
}

export const useKeyboardShortcuts = (shortcuts: ShortcutConfig[]) => {
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      for (const shortcut of shortcuts) {
        const matchesKey = e.key.toLowerCase() === shortcut.key.toLowerCase();
        const matchesCtrl = shortcut.ctrl ? e.ctrlKey : !e.ctrlKey;
        const matchesShift = shortcut.shift ? e.shiftKey : !e.shiftKey;
        const matchesAlt = shortcut.alt ? e.altKey : !e.altKey;
        const matchesMeta = shortcut.meta ? e.metaKey : !e.metaKey;

        if (matchesKey && matchesCtrl && matchesShift && matchesAlt && matchesMeta) {
          e.preventDefault();
          shortcut.action();
          break;
        }
      }
    };

    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, [shortcuts]);
};
```

**åº”ç”¨åˆ°ä¹¦ç­¾é¡µé¢**ï¼š

```typescript
// src/pages/newtab/components/BookmarkPage.tsx
useKeyboardShortcuts([
  {
    key: 'n',
    ctrl: true,
    description: 'æ–°å»ºä¹¦ç­¾',
    action: () => setShowAddModal(true)
  },
  {
    key: 'f',
    ctrl: true,
    description: 'æ–°å»ºæ–‡ä»¶å¤¹',
    action: () => setShowAddFolderModal(true)
  },
  {
    key: 'a',
    ctrl: true,
    description: 'å…¨é€‰',
    action: () => selectAll()
  },
  {
    key: 'Delete',
    description: 'åˆ é™¤é€‰ä¸­é¡¹',
    action: () => handleBatchDelete()
  },
  {
    key: '/',
    description: 'èšç„¦æœç´¢æ¡†',
    action: () => searchInputRef.current?.focus()
  }
]);
```

**å¿«æ·é”®å¸®åŠ©é¢æ¿**ï¼š

```typescript
// src/components/KeyboardShortcutsHelp.tsx
export const KeyboardShortcutsHelp: React.FC = () => {
  const [isOpen, setIsOpen] = useState(false);

  const shortcuts = [
    { keys: ['Ctrl', 'N'], description: 'æ–°å»ºä¹¦ç­¾' },
    { keys: ['Ctrl', 'F'], description: 'æ–°å»ºæ–‡ä»¶å¤¹' },
    { keys: ['Ctrl', 'A'], description: 'å…¨é€‰' },
    { keys: ['Delete'], description: 'åˆ é™¤é€‰ä¸­é¡¹' },
    { keys: ['/'], description: 'èšç„¦æœç´¢æ¡†' },
    { keys: ['Ctrl', 'Z'], description: 'æ’¤é”€' },
    { keys: ['Ctrl', 'Shift', 'Z'], description: 'é‡åš' },
    { keys: ['Esc'], description: 'å…³é—­å¼¹çª—' }
  ];

  return (
    <>
      <button
        onClick={() => setIsOpen(true)}
        className="text-sm text-gray-500 hover:text-gray-700"
        aria-label="æŸ¥çœ‹é”®ç›˜å¿«æ·é”®"
      >
        âŒ¨ï¸ å¿«æ·é”®
      </button>

      {isOpen && (
        <Modal onClose={() => setIsOpen(false)} title="é”®ç›˜å¿«æ·é”®">
          <div className="space-y-2">
            {shortcuts.map((shortcut, i) => (
              <div key={i} className="flex justify-between items-center">
                <span className="text-gray-700">{shortcut.description}</span>
                <div className="flex gap-1">
                  {shortcut.keys.map((key, j) => (
                    <kbd
                      key={j}
                      className="px-2 py-1 bg-gray-200 rounded text-sm font-mono"
                    >
                      {key}
                    </kbd>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </Modal>
      )}
    </>
  );
};
```

---

## 7. æ€§èƒ½æ„ŸçŸ¥ä¼˜åŒ–

### 7.1 åŠ è½½è¿›åº¦æŒ‡ç¤º

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
**éš¾åº¦**: â­ ç®€å•

**åˆ›å»ºè¿›åº¦è¿½è¸ªå™¨**ï¼š

```typescript
// src/hooks/useLoadingProgress.ts
export const useLoadingProgress = (totalSteps: number) => {
  const [currentStep, setCurrentStep] = useState(0);
  const progress = (currentStep / totalSteps) * 100;

  const nextStep = () => setCurrentStep(prev => Math.min(prev + 1, totalSteps));
  const reset = () => setCurrentStep(0);

  return { progress, nextStep, reset };
};
```

**åº”ç”¨åˆ°å†å²è®°å½•åŠ è½½**ï¼š

```typescript
// src/pages/newtab/hooks/useEnhancedHistory.ts
const { progress, nextStep, reset } = useLoadingProgress(3);

const loadHistory = async () => {
  reset();
  setLoading(true);

  try {
    nextStep(); // Step 1: è·å–æ—¥æœŸèŒƒå›´
    const dates = await fetchAvailableDates();

    nextStep(); // Step 2: è·å–å†å²è®°å½•
    const items = await chrome.history.search({ text: '', maxResults: 1000 });

    nextStep(); // Step 3: å¤„ç†æ•°æ®
    const grouped = groupByDate(items);

    setHistory(grouped);
  } finally {
    setLoading(false);
  }
};

// åœ¨ UI ä¸­æ˜¾ç¤ºè¿›åº¦
{loading && <ProgressBar progress={progress} message="æ­£åœ¨åŠ è½½å†å²è®°å½•..." />}
```

---

### 7.2 è™šæ‹Ÿæ»šåŠ¨æç¤º

**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­
**éš¾åº¦**: â­ ç®€å•

**æ˜¾ç¤ºæ•°æ®é‡æç¤º**ï¼š

```typescript
// å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œæç¤ºç”¨æˆ·æ€§èƒ½å½±å“
{items.length > 1000 && (
  <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
    <div className="flex">
      <div className="flex-shrink-0">âš ï¸</div>
      <div className="ml-3">
        <p className="text-sm text-yellow-700">
          å½“å‰æ˜¾ç¤º {items.length} æ¡è®°å½•ï¼Œå¯èƒ½å½±å“æ€§èƒ½ã€‚
          å»ºè®®ä½¿ç”¨æœç´¢æˆ–ç­›é€‰åŠŸèƒ½ç¼©å°èŒƒå›´ã€‚
        </p>
      </div>
    </div>
  </div>
)}
```

---

## æ€»ç»“

### å®æ–½ä¼˜å…ˆçº§çŸ©é˜µ

| ä¼˜åŒ–é¡¹ | ä¼˜å…ˆçº§ | éš¾åº¦ | é¢„è®¡æ—¶é—´ | å½±å“èŒƒå›´ |
|--------|--------|------|----------|----------|
| **åŠ è½½çŠ¶æ€ - éª¨æ¶å±** | ğŸ”¥ é«˜ | â­â­ ä¸­ | 2-3å¤© | æ‰€æœ‰é¡µé¢ |
| **é”™è¯¯æç¤º - Toast ç³»ç»Ÿ** | ğŸ”¥ é«˜ | â­â­ ä¸­ | 1-2å¤© | å…¨å±€ |
| **æ— éšœç¢ - ARIA æ ‡ç­¾** | ğŸ”¥ é«˜ | â­ ä½ | 1å¤© | æ‰€æœ‰äº¤äº’å…ƒç´  |
| **æ‰¹é‡æ“ä½œç¡®è®¤** | ğŸ”¥ é«˜ | â­ ä½ | åŠå¤© | ä¹¦ç­¾/å†å²é¡µé¢ |
| **æ’¤é”€/é‡åšåŠŸèƒ½** | ğŸ”¥ é«˜ | â­â­â­ é«˜ | 3-5å¤© | ä¹¦ç­¾æ“ä½œ |
| **å›½é™…åŒ– (i18n)** | ğŸŸ¡ ä¸­ | â­â­â­ é«˜ | 3-4å¤© | å…¨å±€ |
| **æ¨¡æ€æ¡†ç„¦ç‚¹ç®¡ç†** | ğŸ”¥ é«˜ | â­â­ ä¸­ | 1å¤© | æ‰€æœ‰æ¨¡æ€æ¡† |
| **ä¹¦ç­¾å¯¼å…¥** | ğŸŸ¡ ä¸­ | â­â­ ä¸­ | 2å¤© | ä¹¦ç­¾é¡µé¢ |
| **é”®ç›˜å¿«æ·é”®** | ğŸŸ¡ ä¸­ | â­â­ ä¸­ | 2å¤© | ä¸»è¦é¡µé¢ |
| **æ‹–æ‹½æ’åº** | ğŸŸ¡ ä¸­ | â­â­â­ é«˜ | 3å¤© | ä¹¦ç­¾é¡µé¢ |
| **æœç´¢å†å²** | ğŸŸ¢ ä½ | â­ ä½ | åŠå¤© | æœç´¢æ¡† |
| **ä¹¦ç­¾é¢„è§ˆ** | ğŸŸ¢ ä½ | â­â­â­ é«˜ | 3-4å¤© | ä¹¦ç­¾é¡µé¢ |

### å»ºè®®å®æ–½è·¯çº¿

**Phase 1 - å¿«é€Ÿæ”¹è¿›ï¼ˆ1å‘¨ï¼‰**ï¼š
1. éª¨æ¶å±åŠ è½½çŠ¶æ€
2. Toast é”™è¯¯æç¤ºç³»ç»Ÿ
3. ARIA æ ‡ç­¾è¡¥å……
4. æ‰¹é‡æ“ä½œç¡®è®¤å¯¹è¯æ¡†

**Phase 2 - æ ¸å¿ƒåŠŸèƒ½ï¼ˆ2å‘¨ï¼‰**ï¼š
1. æ’¤é”€/é‡åšåŠŸèƒ½
2. æ¨¡æ€æ¡†æ— éšœç¢æ”¹è¿›
3. é”™è¯¯æ¶ˆæ¯æœ¬åœ°åŒ–

**Phase 3 - é«˜çº§åŠŸèƒ½ï¼ˆ2-3å‘¨ï¼‰**ï¼š
1. å®Œæ•´çš„ i18n å›½é™…åŒ–
2. ä¹¦ç­¾å¯¼å…¥åŠŸèƒ½
3. é”®ç›˜å¿«æ·é”®ç³»ç»Ÿ

**Phase 4 - é”¦ä¸Šæ·»èŠ±ï¼ˆæŒ‰éœ€ï¼‰**ï¼š
1. æ‹–æ‹½æ’åº
2. æœç´¢å†å²
3. ä¹¦ç­¾é¢„è§ˆ

---

## é™„å½•ï¼šä»£ç æ¨¡æ¿

æ‰€æœ‰ç¤ºä¾‹ä»£ç éƒ½å¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼Œå·²æ ¹æ®é¡¹ç›®ç°æœ‰ç»“æ„å’ŒæŠ€æœ¯æ ˆï¼ˆReact 19 + TypeScript 5 + Tailwind CSS 4ï¼‰è¿›è¡Œè°ƒæ•´ã€‚

å»ºè®®åœ¨å®æ–½å‰ï¼š
1. âœ… åˆ›å»ºæ–°åˆ†æ”¯è¿›è¡Œå¼€å‘
2. âœ… é€ä¸ªåŠŸèƒ½æµ‹è¯•éªŒè¯
3. âœ… è€ƒè™‘æ€§èƒ½å½±å“
4. âœ… ç¡®ä¿å‘åå…¼å®¹

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€
